--==[ Services ]==--
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local TweenService = game:GetService("TweenService")

--==[ Settings ]==--
local ESPEnabled = true
local ReticleEnabled = true
local MagneticEnabled = true
local LockTargetEnabled = true
local ReticleSize = 100
local MagneticForce = 300
local UpdateInterval = 1
local Highlights = {}
local CurrentTarget = nil

--==[ GUI Setup ]==--
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ProUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0,250,0,120)
MainFrame.Position = UDim2.new(0.35,0,0.05,0)
MainFrame.BackgroundColor3 = Color3.fromRGB(20,20,20)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0,12)
Corner.Parent = MainFrame

local Stroke = Instance.new("UIStroke")
Stroke.Thickness = 2
Stroke.Color = Color3.fromRGB(0,255,0)
Stroke.Parent = MainFrame

-- Close Button ❌
local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0,40,0,40)
CloseBtn.Position = UDim2.new(1,-45,0,5)
CloseBtn.Text = "❌"
CloseBtn.TextScaled = true
CloseBtn.Font = Enum.Font.SourceSansBold
CloseBtn.TextColor3 = Color3.fromRGB(255,0,0)
CloseBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
CloseBtn.BorderSizePixel = 0
CloseBtn.Parent = MainFrame

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0,6)
CloseCorner.Parent = CloseBtn

local CloseStroke = Instance.new("UIStroke")
CloseStroke.Thickness = 1.5
CloseStroke.Color = Color3.fromRGB(0,255,0)
CloseStroke.Parent = CloseBtn

-- Hover effect
CloseBtn.MouseEnter:Connect(function()
	TweenService:Create(CloseBtn, TweenInfo.new(0.2), {TextColor3=Color3.fromRGB(255,0,0)}):Play()
end)
CloseBtn.MouseLeave:Connect(function()
	TweenService:Create(CloseBtn, TweenInfo.new(0.2), {TextColor3=Color3.fromRGB(255,0,0)}):Play()
end)

CloseBtn.MouseButton1Click:Connect(function()
	MainFrame.Visible = not MainFrame.Visible
end)

-- Toggle Menu with P
UserInputService.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.KeyCode == Enum.KeyCode.P then
		MainFrame.Visible = not MainFrame.Visible
	end
end)

--==[ Slider Reticle ]==--
local SliderLabel = Instance.new("TextLabel")
SliderLabel.Size = UDim2.new(1,-60,0,20)
SliderLabel.Position = UDim2.new(0,10,0,55)
SliderLabel.BackgroundTransparency = 1
SliderLabel.Text = "วงกลม: "..ReticleSize
SliderLabel.TextColor3 = Color3.fromRGB(255,255,255)
SliderLabel.TextXAlignment = Enum.TextXAlignment.Left
SliderLabel.Font = Enum.Font.SourceSansBold
SliderLabel.TextSize = 16
SliderLabel.Parent = MainFrame

local Slider = Instance.new("TextButton")
Slider.Size = UDim2.new(0,80,0,20)
Slider.Position = UDim2.new(1,-90,0,55)
Slider.BackgroundColor3 = Color3.fromRGB(40,40,40)
Slider.Text = "ปรับ"
Slider.TextColor3 = Color3.fromRGB(255,255,255)
Slider.Font = Enum.Font.SourceSansBold
Slider.TextSize = 16
Slider.Parent = MainFrame

local SliderCorner = Instance.new("UICorner")
SliderCorner.CornerRadius = UDim.new(0,6)
SliderCorner.Parent = Slider

Slider.MouseButton1Click:Connect(function()
	ReticleSize = ReticleSize + 20
	if ReticleSize > 200 then ReticleSize = 40 end
	SliderLabel.Text = "วงกลม: "..ReticleSize
end)

--==[ Target Reticle Drawing ]==--
local Circle = Drawing.new("Circle")
Circle.Visible = ReticleEnabled
Circle.Color = Color3.fromRGB(255,255,255)
Circle.Thickness = 1.5
Circle.NumSides = 100
Circle.Filled = false
Circle.Transparency = 1
Circle.ZIndex = 9999

RunService.RenderStepped:Connect(function()
	local center = Camera.ViewportSize/2
	Circle.Position = Vector2.new(center.X,center.Y)
	Circle.Radius = ReticleSize/2
	Circle.Visible = ReticleEnabled
end)

--==[ ESP System ]==--
local function CreateESP(player)
	if player == LocalPlayer then return end
	local char = player.Character
	if not char then return end
	if Highlights[player] then return end
	local hl = Instance.new("Highlight")
	hl.Adornee = char
	hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
	hl.FillTransparency = 0.7
	hl.OutlineTransparency = 0
	if player.Team == LocalPlayer.Team then
		hl.FillColor = Color3.fromRGB(0,255,0)
	else
		hl.FillColor = Color3.fromRGB(255,0,0)
	end
	hl.Parent = char
	Highlights[player] = hl
end

task.spawn(function()
	while task.wait(UpdateInterval) do
		if ESPEnabled then
			for _,plr in pairs(Players:GetPlayers()) do
				if plr ~= LocalPlayer then
					CreateESP(plr)
				end
			end
		end
	end
end)

Players.PlayerRemoving:Connect(function(player)
	if Highlights[player] then
		Highlights[player]:Destroy()
		Highlights[player]=nil
	end
end)

--==[ Magnetic Bullet System ]==--
local function getEnemyInCircle()
	local closest, minDist = nil, math.huge
	local center = Camera.ViewportSize/2
	for _,plr in pairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer and plr.Team ~= LocalPlayer.Team and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			local hrp = plr.Character.HumanoidRootPart
			local pos, visible = Camera:WorldToViewportPoint(hrp.Position)
			if visible then
				local dx, dy = pos.X-center.X, pos.Y-center.Y
				local dist = math.sqrt(dx*dx+dy*dy)
				if dist<=ReticleSize/2 and dist<minDist then
					minDist=dist
					closest=hrp
				end
			end
		end
	end
	return closest
end

local function ShootBullet()
	local origin = Camera.CFrame.Position
	local direction = Camera.CFrame.LookVector
	local bullet = Instance.new("Part")
	bullet.Shape = Enum.PartType.Ball
	bullet.Size = Vector3.new(0.3,0.3,0.3)
	bullet.Material = Enum.Material.Neon
	bullet.Color = Color3.fromRGB(255,150,0)
	bullet.CFrame = CFrame.new(origin)
	bullet.Anchored = false
	bullet.CanCollide = false
	bullet.Parent = Workspace

	local bodyVel = Instance.new("BodyVelocity")
	bodyVel.MaxForce = Vector3.new(1e6,1e6,1e6)
	bodyVel.Velocity = direction*200
	bodyVel.Parent = bullet

	local target = getEnemyInCircle()

	if target and MagneticEnabled then
		task.spawn(function()
			while bullet and bullet.Parent do
				if target and target.Parent and target:IsDescendantOf(Workspace) then
					local dir = (target.Position-bullet.Position).Unit
					bodyVel.Velocity = dir*MagneticForce
				else break end
				RunService.Heartbeat:Wait()
			end
		end)
	end

	bullet.Touched:Connect(function(hit)
		local hum = hit.Parent:FindFirstChildOfClass("Humanoid")
		if hum and hit.Parent~=LocalPlayer.Character then
			hum:TakeDamage(25)
			bullet:Destroy()
		end
	end)

	game.Debris:AddItem(bullet,3)
end

UserInputService.InputBegan:Connect(function(input,gp)
	if gp then return end
	if input.UserInputType==Enum.UserInputType.MouseButton1 then
		ShootBullet()
	end
end)

print("✅ ระบบสมบูรณ์: ESP + Reticle + Magnetic Bullet + GUI หรู พร้อมเปิด/ปิดด้วยปุ่ม P")
