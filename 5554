-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- Settings
local FOVRadius = 100 -- ขนาดวงกลม FOV เริ่มต้น
local LockSpeed = 0.3 -- ความเร็วล็อคเป้า
local TouchAimEnabled = true -- ใช้สำหรับมือถือ

-- Function: หาศัตรูใกล้ crosshair
local function GetClosestEnemy()
    local closestDistance = FOVRadius
    local target = nil

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Team ~= LocalPlayer.Team then
            local character = player.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                local screenPos, onScreen = Camera:WorldToScreenPoint(character.HumanoidRootPart.Position)
                if onScreen then
                    local distance = (Vector2.new(screenPos.X, screenPos.Y) - Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).Magnitude
                    if distance < closestDistance then
                        closestDistance = distance
                        target = character.HumanoidRootPart
                    end
                end
            end
        end
    end

    return target
end

-- UI: วาดวงกลม FOV
local FOVCircle = Drawing.new("Circle")
FOVCircle.Visible = true
FOVCircle.Radius = FOVRadius
FOVCircle.Color = Color3.fromRGB(255,0,0)
FOVCircle.Thickness = 2
FOVCircle.Filled = false

-- ฟังก์ชันปรับขนาด FOV (ใช้มือถือหรือปุ่มเพิ่มลด)
local function SetFOV(size)
    FOVRadius = size
    FOVCircle.Radius = FOVRadius
end

-- ตัวอย่าง: ปรับ FOV ด้วยปุ่ม (+/-) (มือถืออาจปรับเป็น UI slider)
UserInputService.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == Enum.KeyCode.Up then
            SetFOV(FOVRadius + 10)
        elseif input.KeyCode == Enum.KeyCode.Down then
            SetFOV(FOVRadius - 10)
        end
    end
end)

-- Update loop
RunService.RenderStepped:Connect(function()
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

    if TouchAimEnabled then
        local target = GetClosestEnemy()
        if target then
            local targetPos = target.Position
            local cameraPos = Camera.CFrame.Position
            local direction = (targetPos - cameraPos).Unit
            Camera.CFrame = CFrame.new(cameraPos, cameraPos + direction * 1000:Lerp(targetPos, LockSpeed))
        end
    end
end)
