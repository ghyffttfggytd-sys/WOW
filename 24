-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera

-- Settings
local targetCircleSize = 80
local espEnabled = true
local lockTargetEnabled = true
local guiVisible = true
local highlightList = {}
local currentTarget = nil

-- GUI
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.ResetOnSpawn = false

-- ‡∏ß‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠
local targetCircle = Instance.new("Frame", gui)
targetCircle.Size = UDim2.new(0, targetCircleSize, 0, targetCircleSize)
targetCircle.Position = UDim2.new(0.5, 0, 0.5, 0)
targetCircle.AnchorPoint = Vector2.new(0.5, 0.5)
targetCircle.BackgroundTransparency = 1
targetCircle.BorderSizePixel = 3
targetCircle.BorderColor3 = Color3.fromRGB(255,0,0)
targetCircle.ZIndex = 10

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° modern
local function createButton(parent, text, position, size, color)
    local btn = Instance.new("TextButton", parent)
    btn.Size = size
    btn.Position = position
    btn.Text = text
    btn.BackgroundColor3 = color
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Font = Enum.Font.GothamSemibold
    btn.TextScaled = true
    btn.BorderSizePixel = 0
    local corner = Instance.new("UICorner", btn)
    corner.CornerRadius = UDim.new(0, 10)
    local stroke = Instance.new("UIStroke", btn)
    stroke.Color = Color3.fromRGB(80,80,80)
    stroke.Thickness = 1

    -- Hover effect
    btn.MouseEnter:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.15), {BackgroundTransparency = 0.7}):Play()
    end)
    btn.MouseLeave:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.15), {BackgroundTransparency = 0}):Play()
    end)

    return btn
end

-- Frame GUI modern overlay
local menuFrame = Instance.new("Frame", gui)
menuFrame.Size = UDim2.new(0, 250, 0, 230)
menuFrame.Position = UDim2.new(0.05,0,0.6,0)
menuFrame.BackgroundColor3 = Color3.fromRGB(25,25,25)
menuFrame.BorderSizePixel = 0
menuFrame.ClipsDescendants = true
menuFrame.ZIndex = 5
local corner = Instance.new("UICorner", menuFrame)
corner.CornerRadius = UDim.new(0, 15)

-- Drag functionality
local dragging = false
local dragInput, mousePos, framePos
menuFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        mousePos = input.Position
        framePos = menuFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)
menuFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)
RunService.RenderStepped:Connect(function()
    if dragging and dragInput then
        local delta = dragInput.Position - mousePos
        menuFrame.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X,
                                       framePos.Y.Scale, framePos.Y.Offset + delta.Y)
    end
end)

-- Header
local title = Instance.new("TextLabel", menuFrame)
title.Size = UDim2.new(1,0,0,40)
title.Text = "üéØ Target Settings"
title.TextScaled = true
title.BackgroundColor3 = Color3.fromRGB(45,45,45)
title.BorderSizePixel = 0
title.TextColor3 = Color3.fromRGB(255,255,255)
title.Font = Enum.Font.GothamSemibold
local titleCorner = Instance.new("UICorner", title)
titleCorner.CornerRadius = UDim.new(0, 12)

-- ‡∏õ‡∏∏‡πà‡∏° ESP
local espButton = createButton(menuFrame, "ESP: ‡πÄ‡∏õ‡∏¥‡∏î", UDim2.new(0,10,0,50), UDim2.new(1,-20,0,40), Color3.fromRGB(0,170,0))
espButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    if espEnabled then
        espButton.Text = "ESP: ‡πÄ‡∏õ‡∏¥‡∏î"
        espButton.BackgroundColor3 = Color3.fromRGB(0,170,0)
    else
        espButton.Text = "ESP: ‡∏õ‡∏¥‡∏î"
        espButton.BackgroundColor3 = Color3.fromRGB(170,0,0)
        for _,hl in pairs(highlightList) do
            if hl and hl.Parent then hl:Destroy() end
        end
        highlightList = {}
    end
end)

-- ‡∏õ‡∏∏‡πà‡∏° Lock Target
local lockButton = createButton(menuFrame, "Lock Target: ‡πÄ‡∏õ‡∏¥‡∏î", UDim2.new(0,10,0,100), UDim2.new(1,-20,0,40), Color3.fromRGB(0,170,0))
lockButton.MouseButton1Click:Connect(function()
    lockTargetEnabled = not lockTargetEnabled
    if lockTargetEnabled then
        lockButton.Text = "Lock Target: ‡πÄ‡∏õ‡∏¥‡∏î"
        lockButton.BackgroundColor3 = Color3.fromRGB(0,170,0)
    else
        lockButton.Text = "Lock Target: ‡∏õ‡∏¥‡∏î"
        lockButton.BackgroundColor3 = Color3.fromRGB(170,0,0)
        currentTarget = nil
    end
end)

-- ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ß‡∏á
local sizeLabel = Instance.new("TextLabel", menuFrame)
sizeLabel.Size = UDim2.new(1,-20,0,30)
sizeLabel.Position = UDim2.new(0,10,0,150)
sizeLabel.Text = "Circle Size: "..targetCircleSize
sizeLabel.TextScaled = true
sizeLabel.BackgroundTransparency = 1
sizeLabel.TextColor3 = Color3.fromRGB(255,255,255)
sizeLabel.Font = Enum.Font.Gotham

local increaseCircle = createButton(menuFrame, "+", UDim2.new(0,10,0,180), UDim2.new(0.45,-15,0,30), Color3.fromRGB(0,170,0))
local decreaseCircle = createButton(menuFrame, "-", UDim2.new(0.5,5,0,180), UDim2.new(0.45,-15,0,30), Color3.fromRGB(170,0,0))

increaseCircle.MouseButton1Click:Connect(function()
    targetCircleSize = math.clamp(targetCircleSize+10,20,300)
    targetCircle.Size = UDim2.new(0,targetCircleSize,0,targetCircleSize)
    sizeLabel.Text = "Circle Size: "..targetCircleSize
end)
decreaseCircle.MouseButton1Click:Connect(function()
    targetCircleSize = math.clamp(targetCircleSize-10,20,300)
    targetCircle.Size = UDim2.new(0,targetCircleSize,0,targetCircleSize)
    sizeLabel.Text = "Circle Size: "..targetCircleSize
end)

-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î UI
local toggleUIButton = createButton(gui, "UI: ‡∏õ‡∏¥‡∏î/‡πÄ‡∏õ‡∏¥‡∏î", UDim2.new(0.8,0,0.05,0), UDim2.new(0,120,0,30), Color3.fromRGB(100,100,100))
toggleUIButton.MouseButton1Click:Connect(function()
    guiVisible = not guiVisible
    menuFrame.Visible = guiVisible
    targetCircle.Visible = guiVisible
end)

-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏á
local function isInCircle(pos)
    local screenPos, onScreen = camera:WorldToViewportPoint(pos)
    if not onScreen then return false end
    local centerX, centerY = camera.ViewportSize.X/2, camera.ViewportSize.Y/2
    local dx = screenPos.X - centerX
    local dy = screenPos.Y - centerY
    return (dx*dx + dy*dy) <= (targetCircleSize/2)^2
end

-- Highlight ‡∏ó‡∏∞‡∏•‡∏∏‡∏Å‡∏≥‡πÅ‡∏û‡∏á
local function highlightPlayer(character, color)
    if highlightList[character] then return end
    local hl = Instance.new("Highlight")
    hl.FillColor = color
    hl.OutlineColor = color
    hl.Parent = character
    highlightList[character] = hl
end

-- ESP ‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
spawn(function()
    while true do
        if espEnabled then
            for _,plr in pairs(Players:GetPlayers()) do
                if plr.Character and plr.Character:FindFirstChild("Humanoid") then
                    local color = (plr.Team == player.Team) and Color3.fromRGB(0,255,0) or Color3.fromRGB(255,0,0)
                    highlightPlayer(plr.Character, color)
                end
            end
        end
        wait(1)
    end
end)

-- Lock Target (‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏µ‡∏°)
RunService.RenderStepped:Connect(function()
    if lockTargetEnabled then
        local closestDist = math.huge
        local closestEnemy = nil
        for _,plr in pairs(Players:GetPlayers()) do
            if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                if plr.Team ~= player.Team then
                    local root = plr.Character.HumanoidRootPart
                    if isInCircle(root.Position) then
                        local dist = (root.Position - camera.CFrame.Position).Magnitude
                        if dist < closestDist then
                            closestDist = dist
                            closestEnemy = plr.Character
                        end
                    end
                end
            end
        end
        currentTarget = closestEnemy
        if currentTarget and currentTarget:FindFirstChild("HumanoidRootPart") then
            camera.CFrame = CFrame.new(camera.CFrame.Position, currentTarget.HumanoidRootPart.Position)
        end
    else
        currentTarget = nil
    end
end)
